import{E as e,T as t,_ as n,a as r,b as i,g as a,h as o,i as s,m as c,o as l,r as u,u as d,w as f,y as p}from"./index-Dzohr1b9.js";import{i as m,n as h,o as g,r as _,t as v}from"./wordsCache-BZ4gcfdz-BnHwzGpD-D8q4o8UH-DxsJo8h8.js";import{n as y,t as b}from"./Header-BrePaYqJ-CupKeyHn-CUyZQLGM-zp5tyZQ_.js";import{i as x,n as S,r as C,t as w}from"./wordsSync-CtTC9yYS-DuYymlL7-CbI_ITsd-BHAGtb5E.js";var T=o(),E={dialog:`_dialog_yd6at_1`,form:`_form_yd6at_6`,message:`_message_yd6at_13`,field:`_field_yd6at_17`,label:`_label_yd6at_23`,input:`_input_yd6at_29`,actions:`_actions_yd6at_33`},D=s(),O=({visible:n,onHide:o,onWordAdded:s,editWordId:y,editWordData:b})=>{let{t:x}=e(),[S,C]=(0,T.useState)(``),[w,O]=(0,T.useState)(``),[k,A]=(0,T.useState)(``),[j,M]=(0,T.useState)(``),N=!!(y&&b);(0,T.useEffect)(()=>{n&&b?(C(b.ru||``),O(b.en||``),A(b.ko||``)):n||(C(``),O(``),A(``))},[n,b]);let P=async()=>{if(!S.trim()||!w.trim()||!k.trim()){M(x(`fillAllFields`));return}if(!d.currentUser){M(x(`userNotAuthenticated`));return}M(``);try{let e={ru:S.trim(),en:w.trim(),ko:k.trim(),translations:{ru:S.trim(),en:w.trim(),ko:k.trim()}};if(N&&y){if(d.currentUser)try{g(d.currentUser.uid,y,e)}catch(e){console.error(`Ошибка обновления кэша:`,e)}C(``),O(``),A(``),o(),s&&s(),i(f(t,`words`,y),e).catch(e=>{console.error(`Ошибка обновления слова в Firebase:`,e)})}else{let n=`temp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r={id:n,...e,userId:d.currentUser.uid,createdAt:new Date};if(d.currentUser)try{m(d.currentUser.uid,r)}catch(e){console.error(`Ошибка обновления кэша:`,e)}C(``),O(``),A(``),o(),s&&s(),a(p(t,`words`),{...e,userId:d.currentUser.uid,createdAt:new Date}).then(t=>{if(d.currentUser)try{let r=v(d.currentUser.uid)||[],i=r.findIndex(e=>e.id===n);i!==-1&&(r[i]={id:t.id,...e,userId:d.currentUser.uid,createdAt:new Date},_(d.currentUser.uid,r),s&&s())}catch(e){console.error(`Ошибка обновления кэша:`,e)}}).catch(e=>{if(console.error(`Ошибка сохранения слова в Firebase:`,e),d.currentUser)try{h(d.currentUser.uid,n),s&&s()}catch(e){console.error(`Ошибка удаления из кэша:`,e)}})}}catch(e){console.error(`Ошибка сохранения слова:`,e);let t=e instanceof Error?e.message:String(e);M(x(N?`errorUpdatingWord`:`errorAddingWord`)),(t.includes(`permission`)||t.includes(`Permission`))&&M(x(`permissionDenied`)||`Недостаточно прав для выполнения операции`)}},F=()=>{C(``),O(``),A(``),M(``),o()};return(0,D.jsx)(l,{visible:n,onHide:F,header:x(N?`editWord`:`addNewWord`),className:E.dialog,modal:!0,children:(0,D.jsxs)(`div`,{className:E.form,children:[j&&(0,D.jsx)(c,{severity:`error`,text:j,className:E.message}),(0,D.jsxs)(`div`,{className:E.field,children:[(0,D.jsx)(`label`,{htmlFor:`russianWord`,className:E.label,children:x(`russianWord`)}),(0,D.jsx)(r,{id:`russianWord`,value:S,onChange:e=>C(e.target.value),className:E.input,placeholder:x(`enterRussianWord`)})]}),(0,D.jsxs)(`div`,{className:E.field,children:[(0,D.jsx)(`label`,{htmlFor:`englishWord`,className:E.label,children:x(`englishWord`)}),(0,D.jsx)(r,{id:`englishWord`,value:w,onChange:e=>O(e.target.value),className:E.input,placeholder:x(`enterEnglishWord`)})]}),(0,D.jsxs)(`div`,{className:E.field,children:[(0,D.jsx)(`label`,{htmlFor:`koreanWord`,className:E.label,children:x(`koreanWord`)}),(0,D.jsx)(r,{id:`koreanWord`,value:k,onChange:e=>A(e.target.value),className:E.input,placeholder:x(`enterKoreanWord`)})]}),(0,D.jsxs)(`div`,{className:E.actions,children:[(0,D.jsx)(u,{label:x(`cancel`),onClick:F,severity:`secondary`,outlined:!0}),(0,D.jsx)(u,{label:x(N?`saveWord`:`addWord`),onClick:P})]})]})})},k={dictionaryContainer:`_dictionaryContainer_1cu70_1`,content:`_content_1cu70_8`,actions:`_actions_1cu70_17`,addButton:`_addButton_1cu70_23`,cardsContainer:`_cardsContainer_1cu70_27`,loading:`_loading_1cu70_34`,emptyState:`_emptyState_1cu70_41`,deleteDialog:`_deleteDialog_1cu70_66`,deleteContent:`_deleteContent_1cu70_71`,deleteActions:`_deleteActions_1cu70_75`},A=({onNavigateToMain:r})=>{let{t:i}=e(),a=()=>{if(!d.currentUser)return[];let e=v(d.currentUser.uid);return e===null?[]:e},o=()=>{if(!d.currentUser)return!1;let e=v(d.currentUser.uid);return e===null||e.length===0},[s,c]=(0,T.useState)(a),[p,m]=(0,T.useState)(o),[g,_]=(0,T.useState)(!1),[E,A]=(0,T.useState)(null),[j,M]=(0,T.useState)(null);(0,T.useEffect)(()=>{if(!d.currentUser)return;let e=v(d.currentUser.uid),t=e!==null&&e.length>0,n=S(d.currentUser.uid,e=>{c(e),m(!1)});return t?w(d.currentUser.uid).then(e=>{e&&c(e)}):w(d.currentUser.uid).then(e=>{e&&c(e),m(!1)}),n},[]);let N=()=>{if(d.currentUser){let e=v(d.currentUser.uid);e!==null&&c(e)}A(null)},P=(e,t)=>{A({id:e,data:t}),_(!0)},F=e=>{M(e)};return(0,D.jsxs)(`div`,{className:k.dictionaryContainer,children:[(0,D.jsx)(y,{title:i(`myDictionary`),showNavigation:!0,onNavigateToMain:r}),(0,D.jsxs)(`div`,{className:k.content,children:[(0,D.jsx)(`div`,{className:k.actions,children:(0,D.jsx)(b,{onClick:()=>_(!0),icon:`pi pi-plus`,label:i(`addNewWord`),className:k.addButton})}),p?(0,D.jsx)(`div`,{className:k.loading,children:i(`loading`)}):s.length===0?(0,D.jsx)(`div`,{className:k.emptyState,children:(0,D.jsx)(`p`,{children:i(`noWords`)})}):(0,D.jsx)(`div`,{className:k.cardsContainer,children:s.map(e=>(0,D.jsx)(C,{wordId:e.id,wordData:{ru:e.ru,en:e.en,ko:e.ko,translations:e.translations},showActions:!0,onEdit:P,onDelete:F},e.id))})]}),(0,D.jsx)(x,{}),(0,D.jsx)(O,{visible:g,onHide:()=>{_(!1),A(null)},onWordAdded:N,editWordId:E?.id,editWordData:E?.data}),(0,D.jsx)(l,{visible:!!j,onHide:()=>M(null),header:i(`confirmDelete`),modal:!0,className:k.deleteDialog,children:(0,D.jsxs)(`div`,{className:k.deleteContent,children:[(0,D.jsx)(`p`,{children:i(`confirmDeleteMessage`)}),(0,D.jsxs)(`div`,{className:k.deleteActions,children:[(0,D.jsx)(u,{label:i(`cancel`),onClick:()=>M(null),severity:`secondary`,outlined:!0}),(0,D.jsx)(u,{label:i(`delete`),onClick:async()=>{if(!j||!d.currentUser)return;let e=j;M(null);try{h(d.currentUser.uid,e),c(t=>t.filter(t=>t.id!==e)),n(f(t,`words`,e)).catch(e=>{console.error(`Ошибка удаления слова на сервере:`,e)})}catch(e){console.error(`Ошибка удаления слова:`,e)}},severity:`danger`})]})]})})]})};export{A as default};
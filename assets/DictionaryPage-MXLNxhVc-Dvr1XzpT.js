import{C as e,S as t,_ as n,b as r,l as i,m as a,n as o,o as s,s as c,t as l,u,w as d,x as f,y as p}from"./index-2NryKbWx.js";import{i as m,n as h,o as g,r as _,t as v}from"./wordsCache-BZ4gcfdz-BnHwzGpD.js";import{n as y,t as b}from"./Header-BrePaYqJ-CupKeyHn.js";import{i as x,n as S,r as C,t as w}from"./wordsSync-CtTC9yYS-DuYymlL7.js";var T=e(),E={dialog:`_dialog_yd6at_1`,form:`_form_yd6at_6`,message:`_message_yd6at_13`,field:`_field_yd6at_17`,label:`_label_yd6at_23`,input:`_input_yd6at_29`,actions:`_actions_yd6at_33`},D=d(),O=({visible:e,onHide:s,onWordAdded:d,editWordId:y,editWordData:b})=>{let{t:x}=r(),[S,C]=(0,T.useState)(``),[w,O]=(0,T.useState)(``),[k,A]=(0,T.useState)(``),[j,M]=(0,T.useState)(``),N=!!(y&&b);(0,T.useEffect)(()=>{e&&b?(C(b.ru||``),O(b.en||``),A(b.ko||``)):e||(C(``),O(``),A(``))},[e,b]);let P=async()=>{if(!S.trim()||!w.trim()||!k.trim()){M(x(`fillAllFields`));return}if(!o.currentUser){M(x(`userNotAuthenticated`));return}M(``);try{let e={ru:S.trim(),en:w.trim(),ko:k.trim(),translations:{ru:S.trim(),en:w.trim(),ko:k.trim()}};if(N&&y){if(o.currentUser)try{g(o.currentUser.uid,y,e)}catch(e){console.error(`Ошибка обновления кэша:`,e)}C(``),O(``),A(``),s(),d&&d(),u(i(l,`words`,y),e).catch(e=>{console.error(`Ошибка обновления слова в Firebase:`,e)})}else{let t=`temp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,n={id:t,...e,userId:o.currentUser.uid,createdAt:new Date};if(o.currentUser)try{m(o.currentUser.uid,n)}catch(e){console.error(`Ошибка обновления кэша:`,e)}C(``),O(``),A(``),s(),d&&d(),a(c(l,`words`),{...e,userId:o.currentUser.uid,createdAt:new Date}).then(n=>{if(o.currentUser)try{let r=v(o.currentUser.uid)||[],i=r.findIndex(e=>e.id===t);i!==-1&&(r[i]={id:n.id,...e,userId:o.currentUser.uid,createdAt:new Date},_(o.currentUser.uid,r),d&&d())}catch(e){console.error(`Ошибка обновления кэша:`,e)}}).catch(e=>{if(console.error(`Ошибка сохранения слова в Firebase:`,e),o.currentUser)try{h(o.currentUser.uid,t),d&&d()}catch(e){console.error(`Ошибка удаления из кэша:`,e)}})}}catch(e){console.error(`Ошибка сохранения слова:`,e);let t=e instanceof Error?e.message:String(e);M(x(N?`errorUpdatingWord`:`errorAddingWord`)),(t.includes(`permission`)||t.includes(`Permission`))&&M(x(`permissionDenied`)||`Недостаточно прав для выполнения операции`)}},F=()=>{C(``),O(``),A(``),M(``),s()};return(0,D.jsx)(p,{visible:e,onHide:F,header:x(N?`editWord`:`addNewWord`),className:E.dialog,modal:!0,children:(0,D.jsxs)(`div`,{className:E.form,children:[j&&(0,D.jsx)(n,{severity:`error`,text:j,className:E.message}),(0,D.jsxs)(`div`,{className:E.field,children:[(0,D.jsx)(`label`,{htmlFor:`russianWord`,className:E.label,children:x(`russianWord`)}),(0,D.jsx)(t,{id:`russianWord`,value:S,onChange:e=>C(e.target.value),className:E.input,placeholder:x(`enterRussianWord`)})]}),(0,D.jsxs)(`div`,{className:E.field,children:[(0,D.jsx)(`label`,{htmlFor:`englishWord`,className:E.label,children:x(`englishWord`)}),(0,D.jsx)(t,{id:`englishWord`,value:w,onChange:e=>O(e.target.value),className:E.input,placeholder:x(`enterEnglishWord`)})]}),(0,D.jsxs)(`div`,{className:E.field,children:[(0,D.jsx)(`label`,{htmlFor:`koreanWord`,className:E.label,children:x(`koreanWord`)}),(0,D.jsx)(t,{id:`koreanWord`,value:k,onChange:e=>A(e.target.value),className:E.input,placeholder:x(`enterKoreanWord`)})]}),(0,D.jsxs)(`div`,{className:E.actions,children:[(0,D.jsx)(f,{label:x(`cancel`),onClick:F,severity:`secondary`,outlined:!0}),(0,D.jsx)(f,{label:x(N?`saveWord`:`addWord`),onClick:P})]})]})})},k={dictionaryContainer:`_dictionaryContainer_1cu70_1`,content:`_content_1cu70_8`,actions:`_actions_1cu70_17`,addButton:`_addButton_1cu70_23`,cardsContainer:`_cardsContainer_1cu70_27`,loading:`_loading_1cu70_34`,emptyState:`_emptyState_1cu70_41`,deleteDialog:`_deleteDialog_1cu70_66`,deleteContent:`_deleteContent_1cu70_71`,deleteActions:`_deleteActions_1cu70_75`},A=({onNavigateToMain:e})=>{let{t}=r(),n=()=>{if(!o.currentUser)return[];let e=v(o.currentUser.uid);return e===null?[]:e},a=()=>{if(!o.currentUser)return!1;let e=v(o.currentUser.uid);return e===null||e.length===0},[c,u]=(0,T.useState)(n),[d,m]=(0,T.useState)(a),[g,_]=(0,T.useState)(!1),[E,A]=(0,T.useState)(null),[j,M]=(0,T.useState)(null);(0,T.useEffect)(()=>{if(!o.currentUser)return;let e=v(o.currentUser.uid),t=e!==null&&e.length>0,n=S(o.currentUser.uid,e=>{u(e),m(!1)});return t?w(o.currentUser.uid).then(e=>{e&&u(e)}):w(o.currentUser.uid).then(e=>{e&&u(e),m(!1)}),n},[]);let N=()=>{if(o.currentUser){let e=v(o.currentUser.uid);e!==null&&u(e)}A(null)},P=(e,t)=>{A({id:e,data:t}),_(!0)},F=e=>{M(e)};return(0,D.jsxs)(`div`,{className:k.dictionaryContainer,children:[(0,D.jsx)(y,{title:t(`myDictionary`),showNavigation:!0,onNavigateToMain:e}),(0,D.jsxs)(`div`,{className:k.content,children:[(0,D.jsx)(`div`,{className:k.actions,children:(0,D.jsx)(b,{onClick:()=>_(!0),icon:`pi pi-plus`,label:t(`addNewWord`),className:k.addButton})}),d?(0,D.jsx)(`div`,{className:k.loading,children:t(`loading`)}):c.length===0?(0,D.jsx)(`div`,{className:k.emptyState,children:(0,D.jsx)(`p`,{children:t(`noWords`)})}):(0,D.jsx)(`div`,{className:k.cardsContainer,children:c.map(e=>(0,D.jsx)(x,{wordId:e.id,wordData:{ru:e.ru,en:e.en,ko:e.ko,translations:e.translations},showActions:!0,onEdit:P,onDelete:F},e.id))})]}),(0,D.jsx)(C,{}),(0,D.jsx)(O,{visible:g,onHide:()=>{_(!1),A(null)},onWordAdded:N,editWordId:E?.id,editWordData:E?.data}),(0,D.jsx)(p,{visible:!!j,onHide:()=>M(null),header:t(`confirmDelete`),modal:!0,className:k.deleteDialog,children:(0,D.jsxs)(`div`,{className:k.deleteContent,children:[(0,D.jsx)(`p`,{children:t(`confirmDeleteMessage`)}),(0,D.jsxs)(`div`,{className:k.deleteActions,children:[(0,D.jsx)(f,{label:t(`cancel`),onClick:()=>M(null),severity:`secondary`,outlined:!0}),(0,D.jsx)(f,{label:t(`delete`),onClick:async()=>{if(!j||!o.currentUser)return;let e=j;M(null);try{h(o.currentUser.uid,e),u(t=>t.filter(t=>t.id!==e)),s(i(l,`words`,e)).catch(e=>{console.error(`Ошибка удаления слова на сервере:`,e)})}catch(e){console.error(`Ошибка удаления слова:`,e)}},severity:`danger`})]})]})})]})};export{A as default};
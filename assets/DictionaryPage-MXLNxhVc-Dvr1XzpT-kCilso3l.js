import{C as e,T as t,c as n,d as r,f as i,g as a,h as o,i as s,l as c,m as l,o as u,p as d,w as f,x as p}from"./index-DiG2Dxd6.js";import{i as m,n as h,o as g,r as _,t as v}from"./wordsCache-BZ4gcfdz-BnHwzGpD-D8q4o8UH.js";import{n as y,t as b}from"./Header-BrePaYqJ-CupKeyHn-CUyZQLGM.js";import{i as x,n as S,r as C,t as w}from"./wordsSync-CtTC9yYS-DuYymlL7-CbI_ITsd.js";var T=r(),E={dialog:`_dialog_yd6at_1`,form:`_form_yd6at_6`,message:`_message_yd6at_13`,field:`_field_yd6at_17`,label:`_label_yd6at_23`,input:`_input_yd6at_29`,actions:`_actions_yd6at_33`},D=e(),O=({visible:e,onHide:r,onWordAdded:p,editWordId:y,editWordData:b})=>{let{t:x}=t(),[S,C]=(0,T.useState)(``),[w,O]=(0,T.useState)(``),[k,A]=(0,T.useState)(``),[j,M]=(0,T.useState)(``),N=!!(y&&b);(0,T.useEffect)(()=>{e&&b?(C(b.ru||``),O(b.en||``),A(b.ko||``)):e||(C(``),O(``),A(``))},[e,b]);let P=async()=>{if(!S.trim()||!w.trim()||!k.trim()){M(x(`fillAllFields`));return}if(!n.currentUser){M(x(`userNotAuthenticated`));return}M(``);try{let e={ru:S.trim(),en:w.trim(),ko:k.trim(),translations:{ru:S.trim(),en:w.trim(),ko:k.trim()}};if(N&&y){if(n.currentUser)try{g(n.currentUser.uid,y,e)}catch(e){console.error(`Ошибка обновления кэша:`,e)}C(``),O(``),A(``),r(),p&&p(),o(c(f,`words`,y),e).catch(e=>{console.error(`Ошибка обновления слова в Firebase:`,e)})}else{let t=`temp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={id:t,...e,userId:n.currentUser.uid,createdAt:new Date};if(n.currentUser)try{m(n.currentUser.uid,a)}catch(e){console.error(`Ошибка обновления кэша:`,e)}C(``),O(``),A(``),r(),p&&p(),i(d(f,`words`),{...e,userId:n.currentUser.uid,createdAt:new Date}).then(r=>{if(n.currentUser)try{let i=v(n.currentUser.uid)||[],a=i.findIndex(e=>e.id===t);a!==-1&&(i[a]={id:r.id,...e,userId:n.currentUser.uid,createdAt:new Date},_(n.currentUser.uid,i),p&&p())}catch(e){console.error(`Ошибка обновления кэша:`,e)}}).catch(e=>{if(console.error(`Ошибка сохранения слова в Firebase:`,e),n.currentUser)try{h(n.currentUser.uid,t),p&&p()}catch(e){console.error(`Ошибка удаления из кэша:`,e)}})}}catch(e){console.error(`Ошибка сохранения слова:`,e);let t=e instanceof Error?e.message:String(e);M(x(N?`errorUpdatingWord`:`errorAddingWord`)),(t.includes(`permission`)||t.includes(`Permission`))&&M(x(`permissionDenied`)||`Недостаточно прав для выполнения операции`)}},F=()=>{C(``),O(``),A(``),M(``),r()};return(0,D.jsx)(l,{visible:e,onHide:F,header:x(N?`editWord`:`addNewWord`),className:E.dialog,modal:!0,children:(0,D.jsxs)(`div`,{className:E.form,children:[j&&(0,D.jsx)(a,{severity:`error`,text:j,className:E.message}),(0,D.jsxs)(`div`,{className:E.field,children:[(0,D.jsx)(`label`,{htmlFor:`russianWord`,className:E.label,children:x(`russianWord`)}),(0,D.jsx)(s,{id:`russianWord`,value:S,onChange:e=>C(e.target.value),className:E.input,placeholder:x(`enterRussianWord`)})]}),(0,D.jsxs)(`div`,{className:E.field,children:[(0,D.jsx)(`label`,{htmlFor:`englishWord`,className:E.label,children:x(`englishWord`)}),(0,D.jsx)(s,{id:`englishWord`,value:w,onChange:e=>O(e.target.value),className:E.input,placeholder:x(`enterEnglishWord`)})]}),(0,D.jsxs)(`div`,{className:E.field,children:[(0,D.jsx)(`label`,{htmlFor:`koreanWord`,className:E.label,children:x(`koreanWord`)}),(0,D.jsx)(s,{id:`koreanWord`,value:k,onChange:e=>A(e.target.value),className:E.input,placeholder:x(`enterKoreanWord`)})]}),(0,D.jsxs)(`div`,{className:E.actions,children:[(0,D.jsx)(u,{label:x(`cancel`),onClick:F,severity:`secondary`,outlined:!0}),(0,D.jsx)(u,{label:x(N?`saveWord`:`addWord`),onClick:P})]})]})})},k={dictionaryContainer:`_dictionaryContainer_1cu70_1`,content:`_content_1cu70_8`,actions:`_actions_1cu70_17`,addButton:`_addButton_1cu70_23`,cardsContainer:`_cardsContainer_1cu70_27`,loading:`_loading_1cu70_34`,emptyState:`_emptyState_1cu70_41`,deleteDialog:`_deleteDialog_1cu70_66`,deleteContent:`_deleteContent_1cu70_71`,deleteActions:`_deleteActions_1cu70_75`},A=({onNavigateToMain:e})=>{let{t:r}=t(),i=()=>{if(!n.currentUser)return[];let e=v(n.currentUser.uid);return e===null?[]:e},a=()=>{if(!n.currentUser)return!1;let e=v(n.currentUser.uid);return e===null||e.length===0},[o,s]=(0,T.useState)(i),[d,m]=(0,T.useState)(a),[g,_]=(0,T.useState)(!1),[E,A]=(0,T.useState)(null),[j,M]=(0,T.useState)(null);(0,T.useEffect)(()=>{if(!n.currentUser)return;let e=v(n.currentUser.uid),t=e!==null&&e.length>0,r=w(n.currentUser.uid,e=>{s(e),m(!1)});return t?C(n.currentUser.uid).then(e=>{e&&s(e)}):C(n.currentUser.uid).then(e=>{e&&s(e),m(!1)}),r},[]);let N=()=>{if(n.currentUser){let e=v(n.currentUser.uid);e!==null&&s(e)}A(null)},P=(e,t)=>{A({id:e,data:t}),_(!0)},F=e=>{M(e)};return(0,D.jsxs)(`div`,{className:k.dictionaryContainer,children:[(0,D.jsx)(y,{title:r(`myDictionary`),showNavigation:!0,onNavigateToMain:e}),(0,D.jsxs)(`div`,{className:k.content,children:[(0,D.jsx)(`div`,{className:k.actions,children:(0,D.jsx)(b,{onClick:()=>_(!0),icon:`pi pi-plus`,label:r(`addNewWord`),className:k.addButton})}),d?(0,D.jsx)(`div`,{className:k.loading,children:r(`loading`)}):o.length===0?(0,D.jsx)(`div`,{className:k.emptyState,children:(0,D.jsx)(`p`,{children:r(`noWords`)})}):(0,D.jsx)(`div`,{className:k.cardsContainer,children:o.map(e=>(0,D.jsx)(S,{wordId:e.id,wordData:{ru:e.ru,en:e.en,ko:e.ko,translations:e.translations},showActions:!0,onEdit:P,onDelete:F},e.id))})]}),(0,D.jsx)(x,{}),(0,D.jsx)(O,{visible:g,onHide:()=>{_(!1),A(null)},onWordAdded:N,editWordId:E?.id,editWordData:E?.data}),(0,D.jsx)(l,{visible:!!j,onHide:()=>M(null),header:r(`confirmDelete`),modal:!0,className:k.deleteDialog,children:(0,D.jsxs)(`div`,{className:k.deleteContent,children:[(0,D.jsx)(`p`,{children:r(`confirmDeleteMessage`)}),(0,D.jsxs)(`div`,{className:k.deleteActions,children:[(0,D.jsx)(u,{label:r(`cancel`),onClick:()=>M(null),severity:`secondary`,outlined:!0}),(0,D.jsx)(u,{label:r(`delete`),onClick:async()=>{if(!j||!n.currentUser)return;let e=j;M(null);try{h(n.currentUser.uid,e),s(t=>t.filter(t=>t.id!==e)),p(c(f,`words`,e)).catch(e=>{console.error(`Ошибка удаления слова на сервере:`,e)})}catch(e){console.error(`Ошибка удаления слова:`,e)}},severity:`danger`})]})]})})]})};export{A as default};